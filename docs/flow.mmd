flowchart TD
    A[Start] --> B{Iteration limit reached?}

    B -- Yes --> C[Ticket set to CANCELED]
    C --> D[Create bug ticket]
    D --> Z[End]

    B -- No --> E[Ticket set to PENDING]

    E --> F{Repository already cloned?}
    F -- No --> G[Clone repository]
    F -- Yes --> H[Pull repository]

    G --> H

    H --> I{Ticket branch exists?}
    I -- No --> J[Create branch]
    I -- Yes --> K[Checkout branch]

    J --> L[Rebase branch]
    K --> L

    L --> M[Retrieve conversation]

    M --> N{Last message exists?}
    N -- No --> O[Create message from ticket]
    N -- Yes --> P[Retrieve last message]

    O --> Q[LLM reasoning]
    P --> Q

    Q --> R[Code modification]
    R --> S[Commit changes]
    S --> T[Run CI]

    T --> U{CI failed?}
    U -- Yes --> V[Add CI error as message]
    V --> B

    U -- No --> W[Ticket set to VALIDATION]
    W --> X[Human validation]

    X -- Rejected --> Y[Write rejection message]
    Y --> AA[Ticket set back to TODO]
    AA --> Z[End]

    X -- Approved --> AB[Create Pull Request]
    AB --> AC[Ticket set to DONE]
    AC --> Z[End]
